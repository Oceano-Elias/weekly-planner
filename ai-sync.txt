AI SYNC (Trae + Gemini)

PURPOSE
This file is the ACTION LOG: the shared, structured record of decisions and execution.
It reduces repeated explanations, makes assumptions explicit, and prevents duplicate/conflicting work.

COMPANION FILE
Use ai-discussion.txt for questions, debate, and brainstorming threads.
Keep this file focused on agreed plans, assignments, and verified results.

GOAL
Build a great app faster by keeping a single, structured, up-to-date plan for:
- bug fixing
- new features
- modernization (tooling, architecture, UI/UX)
- performance and reliability
- refactoring and cleanup
- codebase understanding and technical roadmap

PRINCIPLES
1) Evidence over guessing
   - Prefer reproducible steps, screenshots/logs, and code pointers over opinions.
2) One source of truth
   - This file is the canonical summary. If something changes, update it here.
3) Small, targeted questions
   - Ask the minimum set of questions that disambiguate root cause.
4) Clear ownership
   - Every task has an owner and a completion check.
5) Short, structured entries
   - Avoid long chat logs. Use the template below.
6) Safe iteration
   - Prefer small diffs, easy rollback, and explicit verification steps.

HOW TO USE (WORKFLOW)
This file supports two modes:

MODE A: “DUAL DIAGNOSIS → DEBATE → ONE IMPLEMENTS” (your suggested workflow)
0) Human posts a new Work Block (template below).
1) Trae posts diagnosis + proposed solution + risks.
2) Gemini posts diagnosis + proposed solution + risks.
3) Debate to converge on one plan:
   - what we will change
   - what we will not change
   - how we will verify
4) Decide Implementer:
   - Trae or Gemini (explicitly written in Assignments)
5) Implementer makes changes and updates Results + Verification.
6) Both AIs review the result and either mark Done or define Next move.

MODE B: “ROADMAP / BRAINSTORM” (for product + codebase improvement)
0) Human posts a new Work Block with Topic and Goals.
1) Trae proposes 3–7 options with tradeoffs (impact, risk, effort).
2) Gemini proposes alternatives and flags hidden risks.
3) Agree on a prioritized plan:
   - Now / Next / Later
4) One implementer executes “Now” and reports verified results.

IMPORTANT LIMITATION
Trae does NOT automatically notice changes to this file.
After Gemini updates it, the human must message Trae:
  “Gemini updated ai-sync.txt — please sync.”

RULES TO PREVENT CONFLICTS
- Use the LOCK line to avoid two AIs writing at once.
- Append new Work Blocks; do not rewrite old ones unless doing a “Rollup Summary”.
- If you must revise, add a new entry with “Correction:” instead of editing history.

LOCK
LOCK: none
Allowed values: none | Trae | Gemini | Human

========================
WORK BLOCK: DRAG-AND-DROP RELIABILITY & SMOOTHNESS
========================
ID: DND-RELI-001
Date/Time: 2026-01-13T12:30:00
Owner (overall): Gemini
Type: Bug | Optimization
Priority: P0

Goal: 
1) Fix "snap back" where tasks returned to the calendar when dropped in the sidebar "dead zone."
2) Fix "jump from top-left" and 100ms lag during dragging.

Observations:
- `lastHoverCell` was being prioritized over active sidebar targets in `finishPointerDrag`.
- Ghost elements were inheriting CSS transitions from `.task-block`, causing animation lag.
- Ghost elements were appended to DOM before their initial coordinates were set, causing origin flash.

Decisions:
- Prioritized current pointer target over stale hover states.
- Created `.drag-ghost` CSS class with `!important` transition overrides.
- Used `requestAnimationFrame` for positioning.
- Set initial `transform` before `appendChild`.

Implementation Notes:
- File: `src/components/DragDrop.js`
  - Change: Refactored target selection, added rAF positioning, hid original element during drag.
- File: `src/styles/tasks.css`
  - Change: Added `.drag-ghost` class with ultra-high z-index and no transitions.

Verification:
- Steps: Created task, dragged to calendar, dragged back to sidebar. Repeated with rapid mouse movements.
- Result: Fixed. No jump, no lag, sidebar drop is 100% reliable.

Outcome:
- Status: Done
- Next move: Ready for next task. Human/Trae to propose next Work Block.

========================
WORK BLOCK: GHOST VISIBILITY & TEXT SELECTION
========================
ID: DND-RELI-002
Date/Time: 2026-01-13T12:35:00
Owner (overall): Gemini
Type: Bug
Priority: P1

Goal: 
1) Restore drag ghost visibility (currently invisible during motion).
2) Prevent accidental text selection on the entire page during drag.

Repro:
1) Click and drag any task.
2) Observe the task block becomes physically invisible (ghost inherits opacity 0).
3) Observe page text becomes highlighted/selected.

Hypotheses:
1) Clone inherits `top: -9999px` or other off-screen styles from a simultaneous native drag start.
2) Missing `user-select: none` on `html, body` allows ranges to form on right-click.
3) Context menu is not suppressed, causing browser selection behavior.

Assignments:
- Gemini: Sanitize ghost CSS, suppress context menu, and force global `user-select: none`.

Outcome:
- Status: Done
- Next move: Ready for next task. (Human/Trae)

========================
WORK BLOCK: RESTORE LOST FEATURES (REGRESSIONS)
========================
ID: REG-FIX-001
Date/Time: 2026-01-13T13:10:00
Owner (overall): Gemini
Type: Bug | Refactor
Priority: P0

Goal: 
1) Restore Filters functionality.
2) Restore Date Header navigation (clicking date in week view -> Day view).
3) Restore all focus modal enhancements previously implemented.

Observations:
- Filters are likely broken in `main.js` due to recent state management changes.
- Click listeners on `.day-header` or date numbers might have been lost in the DND refactor.
- Focus modal logic in `main.js` or `index.html` might have been reverted.

Assignments:
- Gemini: Audit `main.js`, `Calendar.js`, and `index.html` to find and fix reverts.

Outcome:
- Status: In Progress
- Next move: Investigating `Calendar.js` for date clicks and `main.js` for filters/modal.
